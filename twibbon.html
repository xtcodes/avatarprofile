<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor Twibbon</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
body {
font-family: 'Segoe UI', sans-serif;
background: #f9f9f9;
color: #333;
text-align: center;
padding: 20px;
}
h1 {
color: #4a90e2;
}
canvas {
border: 2px dashed #4a90e2;
border-radius: 8px;
margin-top: 10px;
touch-action: none;
max-width: 100%;
}
input[type="file"] {
margin: 10px 0;
}
button {
background: #4a90e2;
color: white;
border: none;
padding: 10px 20px;
margin: 10px 5px;
border-radius: 5px;
cursor: pointer;
font-size: 16px;
}
button i {
margin-right: 5px;
}
button:hover {
background: #357ab7;
}
</style>
</head>
<body>
<h1>Editor Twibbon</h1>
<input type="file" id="upload" accept="image/*"><br>
<canvas id="canvas" width="500" height="500"></canvas><br>
<button id="download"><i class="fas fa-download"></i>Unduh Gambar</button>
<button id="share"><i class="fas fa-share-alt"></i>Bagikan</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const upload = document.getElementById('upload');
const download = document.getElementById('download');
const share = document.getElementById('share');

let userImg = new Image();
let twibbonImg = new Image();
let scale = 1, lastDist = null;
let position = { x: 150, y: 150 };
let dragging = false;

upload.addEventListener('change', (e) => {
const file = e.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = () => {
userImg.src = reader.result;
};
reader.readAsDataURL(file);
}
});

userImg.onload = draw;
twibbonImg.onload = draw;
twibbonImg.src = 'frame.png'; // Ganti dengan path twibbon Anda

function draw() {
ctx.clearRect(0, 0, canvas.width, canvas.height);
if (userImg.src) {
const w = userImg.width * scale;
const h = userImg.height * scale;
ctx.drawImage(userImg, position.x - w/2, position.y - h/2, w, h);
}
if (twibbonImg.src) {
ctx.drawImage(twibbonImg, 0, 0, 500, 500);
}
}

canvas.addEventListener('touchstart', (e) => {
if (e.touches.length === 1) dragging = true;
});

canvas.addEventListener('touchmove', (e) => {
e.preventDefault();
if (e.touches.length === 2) {
const dx = e.touches[1].clientX - e.touches[0].clientX;
const dy = e.touches[1].clientY - e.touches[0].clientY;
const dist = Math.hypot(dx, dy);
if (lastDist !== null) {
scale *= dist / lastDist;
scale = Math.min(5, Math.max(0.2, scale));
}
lastDist = dist;
} else if (e.touches.length === 1 && dragging) {
position.x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
position.y = e.touches[0].clientY - canvas.getBoundingClientRect().top;
}
draw();
});

canvas.addEventListener('touchend', () => {
dragging = false;
lastDist = null;
});

download.addEventListener('click', () => {
const link = document.createElement('a');
link.download = 'twibbon.png';
link.href = canvas.toDataURL();
link.click();
});

share.addEventListener('click', async () => {
const blob = await (await fetch(canvas.toDataURL())).blob();
const file = new File([blob], 'twibbon.png', { type: blob.type });

if (navigator.canShare && navigator.canShare({ files: [file] })) {
try {
await navigator.share({
title: 'Twibbon Saya',
text: 'Lihat hasil editan twibbon saya!',
files: [file]
});
} catch (err) {
alert('Berbagi dibatalkan atau gagal.');
}
} else {
alert('Fitur berbagi tidak didukung di perangkat ini.');
}
});
</script>
</body>
</html>
